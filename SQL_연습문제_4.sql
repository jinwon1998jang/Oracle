/*
    날짜:2025/07/22
    이름:장진원
    내용:SQL 연습문제4
*/
--실습4-1
ALTER SESSION Set "_ORACLE_SCRIPT"=true;
CREATE USER library IDENTIFIED BY 1234;
GRANT CONNECT, RESOURCE, UNLIMITED TABLESPACE TO library;
exit
--실습4-2
DROP TABLE MEMBER;
CREATE TABLE MEMBER(
    MEMBER_ID NUMBER(4) NOT NULL PRIMARY KEY,
    NAME VARCHAR2(40) NOT NULL,
    ADDRESS VARCHAR2(100) DEFAULT NULL,
    HP CHAR(13) DEFAULT NULL,
    JOIN_DATE DATE NOT NULL
);

CREATE TABLE BOOK(
    BOOK_ID NUMBER(5) NOT NULL PRIMARY KEY,
    TITLE VARCHAR2(50) NOT NULL,
    AUTHOR VARCHAR2(40) NOT NULL,
    PUBLISHER VARCHAR2(40) NOT NULL,
    AVAILABLE CHAR(1) DEFAULT NULL,
    REG_DATE DATE NOT NULL
);

CREATE TABLE LOAN(
    LOAN_ID NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    MEMBER_ID NUMBER(4) NOT NULL,
    BOOK_ID NUMBER(5) NOT NULL,
    LOAN_DATE DATE DEFAULT NULL,
    RETURN_DATE DATE DEFAULT NULL,
    ACTURAL_DATE DATE DEFAULT NULL,
    FOREIGN KEY (MEMBER_ID) REFERENCES  MEMBER(MEMBER_ID),
    FOREIGN KEY (BOOK_ID) REFERENCES  BOOK(BOOK_ID)
);

--실습4-3
INSERT INTO MEMBER VALUES(1001,'김유신','서울특별시 강남구 역삼동','010-1234-1001','2024-01-10 09:15:00');
INSERT INTO MEMBER VALUES(1002,'김춘추','대전광역시 유성구 장대동','010-1234-1002','2024-02-14 14:30:45');
INSERT INTO MEMBER VALUES(1003,'장보고','대구광역시 수성구 반월동','010-1234-1003','2024-03-01 11:05:20');
INSERT INTO MEMBER VALUES(1004,'강감찬','부산광역시 금정구 부곡동','010-1234-1004','2024-03-22 16:40:00');
INSERT INTO MEMBER VALUES(1005,'이순신','광주광역시 광산구 우산동','010-1234-1005','2024-04-10 08:50:10');

INSERT INTO BOOK VALUES(10001,'태백산맥','조정래','문학수첩','Y','2014-01-10 09:15:00');
INSERT INTO BOOK VALUES(10002,'데미안','헤르만 헤세','민음사','N','2014-02-14 14:30:45');
INSERT INTO BOOK VALUES(10003,'토지','박경리','문학사상사','Y','2014-03-01 11:05:20');
INSERT INTO BOOK VALUES(10004,'명품 자바 프로그래밍','제임스 고슬링','한빛출판사','Y','2014-03-22 16:40:00');
INSERT INTO BOOK VALUES(10005,'로미오와 줄리엣','세익스피어','열린책들','N','2014-04-10 08:50:10');
INSERT INTO BOOK VALUES(10006,'삼국지','나관중','민음사','Y','2014-04-05 09:12:02');
INSERT INTO BOOK VALUES(10007,'칼의 노래','김훈','문학동네','Y','2014-06-10 12:53:17');
INSERT INTO BOOK VALUES(10008,'데이터베이스','래리 엘리슨','한빛출판사','N','2014-05-23 10:13:09');
INSERT INTO BOOK VALUES(10009,'Linux 운영체제','리누스 토발즈','한빛출판사','Y','2014-03-11 11:23:43');
INSERT INTO BOOK VALUES(10010,'어린 왕자','생텍쥐베리','열린책들','Y','2014-05-13 15:27:21');

INSERT INTO LOAN VALUES(1,1001,10002,'2024-03-01 10:02:31','2024-03-15 10:02:31', '2024-03-13 09:44:19');
INSERT INTO LOAN VALUES(2,1002,10004,'2024-03-05 15:10:02','2024-03-19 15:10:02', '2024-03-12 17:12:30');
INSERT INTO LOAN VALUES(3,1003,10008,'2024-04-01 11:01:12','2024-04-15 11:01:12', NULL);
INSERT INTO LOAN VALUES(4,1002,10001,'2024-04-10 14:32:01','2024-04-24 14:32:01', '2024-04-22 13:56:32');
INSERT INTO LOAN VALUES(5,1005,10004,'2024-04-15 16:24:21','2024-04-29 16:24:21', NULL);
INSERT INTO LOAN VALUES(6,1004,10006,'2024-05-01 09:12:09','2024-05-15 09:12:09', '2024-05-14 09:21:27');
INSERT INTO LOAN VALUES(7,1001,10007,'2024-05-03 13:51:07','2024-05-17 13:51:07', '2024-05-16 14:05:10');
INSERT INTO LOAN VALUES(8,1003,10009,'2024-06-01 11:15:43','2024-06-15 11:15:43', NULL);
INSERT INTO LOAN VALUES(9,1004,10004,'2024-06-02 12:30:52','2024-06-16 12:30:52', NULL);
INSERT INTO LOAN VALUES(10,1002,10008,'2024-06-05 10:06:17','2024-06-19 10:06:17', NULL);

--실습4-4
SELECT * FROM MEMBER;
--실습4-6
SELECT NAME,ADDRESS FROM MEMBER WHERE ADDRESS LIKE '부산%';
--실습4-7
SELECT TITLE FROM BOOK WHERE AVAILABLE='Y';
--실습4-8
SELECT * FROM BOOK WHERE BOOK_ID=10005;
--실습4-9
SELECT MEMBER_ID,NAME,HP FROM MEMBER WHERE MEMBER_ID=1002;
--실습4-10
SELECT TITLE FROM BOOK WHERE REG_DATE LIKE '2014-03%';
--실습4-11
SELECT TITLE,AUTHOR,PUBLISHER FROM BOOK WHERE PUBLISHER='민음사';
--실습4-12
SELECT LOAN_ID,MEMBER_ID,BOOK_ID FROM LOAN WHERE ACTURAL_DATE IS NULL;
--실습4-13
SELECT * FROM MEMBER WHERE NAME LIKE '김%';
--실습4-14
SELECT NAME,ADDRESS FROM MEMBER WHERE ADDRESS LIKE '부산%' OR ADDRESS LIKE '대구%';

--실습4-15
SELECT BOOK_ID,TITLE FROM BOOK WHERE BOOK_ID IN(10003,10006);
--실습4-16
SELECT TITLE,AUTHOR FROM BOOK WHERE AUTHOR IN('조정래','박경리');
--실습4-17
SELECT NAME,JOIN_DATE FROM MEMBER WHERE JOIN_DATE<TO_DATE('2024-04-01', 'YYYY-MM-DD');

--실습4-18
SELECT LOAN_ID,MEMBER_ID,BOOK_ID,LOAN_DATE FROM LOAN WHERE LOAN_DATE>=TO_DATE('2024-05','YYYY-MM');
--실습4-19    
SELECT TITLE,AUTHOR,PUBLISHER FROM BOOK WHERE AVAILABLE='N';
--실습4-20
SELECT * FROM BOOK WHERE TITLE LIKE '%자바%';
--실습4-21
SELECT NAME,HP FROM MEMBER WHERE HP!='010-1234-1003';
--실습4-22
SELECT LOAN_ID,MEMBER_ID,BOOK_ID FROM LOAN WHERE RETURN_DATE<TO_DATE('2024-03-20','YYYY-MM-DD');
--실습4-23
SELECT * FROM MEMBER ORDER BY NAME;
--실습4-24
SELECT TITLE,REG_DATE FROM BOOK ORDER BY REG_DATE DESC;
--실습4-25
SELECT TITLE FROM BOOK ORDER BY TITLE FETCH FIRST 3 ROW ONLY;

--실습4-26
SELECT * FROM MEMBER ORDER BY JOIN_DATE DESC FETCH FIRST 1 ROW ONLY;
--실습4-27
SELECT LOAN_ID,LOAN_DATE FROM LOAN ORDER BY LOAN_DATE FETCH FIRST 2 ROW ONLY;
--실습4-28
SELECT COUNT(*) FROM MEMBER;
--실습4-29
SELECT COUNT(*) FROM BOOK;
--실습4-30
SELECT COUNT(*) FROM LOAN WHERE ACTURAL_DATE IS NOT NULL;
--실습4-31
SELECT PUBLISHER, COUNT(*) AS "출판_도서수" FROM BOOK GROUP BY PUBLISHER;
--실습4-32
SELECT COUNT(*) FROM LOAN WHERE TO_CHAR(LOAN_DATE,'YYYY')='2024';
SELECT COUNT(*) FROM LOAN WHERE SUBSTR(LOAN_DATE,1,4)='2024';
--실습4-33
SELECT MEMBER_ID, COUNT(*) FROM LOAN GROUP BY MEMBER_ID;
--실습4-34
SELECT BOOK_ID,COUNT(*) FROM LOAN GROUP BY BOOK_ID;
--실습4-35
SELECT MEMBER_ID,COUNT(*) FROM LOAN GROUP BY MEMBER_ID HAVING COUNT(*)>=2;
--실습4-36
SELECT BOOK_ID,COUNT(*) FROM LOAN GROUP BY BOOK_ID HAVING COUNT(*)>=2;
--실습4-37
SELECT M.MEMBER_ID,M.NAME,B.BOOK_ID,B.TITLE,L.LOAN_DATE FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID ; 
--실습4-38
SELECT NAME,COUNT(*) FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID GROUP BY NAME HAVING COUNT(*)>=3;
--실습4-39
SELECT LOAN_ID,NAME,TITLE,LOAN_DATE FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID WHERE LOAN_DATE<TO_DATE('2024-05','YYYY-MM'); 
--실습4-40
SELECT B.TITLE FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID WHERE M.NAME='김유신'; 
--실습4-41
SELECT M.NAME FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID WHERE B.TITLE='태백산맥'; 
--실습4-42
SELECT B.TITLE FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID WHERE L.MEMBER_ID=1002 ORDER BY B.TITLE; 
--실습4-43
SELECT B.TITLE,M.NAME FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID WHERE LOAN_DATE LIKE '2024-04%'; 

--실습4-44
SELECT M.NAME, B.TITLE FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID WHERE L.ACTURAL_DATE IS NULL; 
--실습4-45
SELECT M.NAME, B.TITLE FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID WHERE B.AUTHOR='조정래'; 
--실습4-46
SELECT
    B.BOOK_ID,
    B.TITLE
FROM
    BOOK B
WHERE
    B.BOOK_ID NOT IN (SELECT BOOK_ID FROM LOAN);
--실습4-47
SELECT M.NAME, COUNT(*) FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID GROUP BY M.NAME ORDER BY COUNT(*) DESC; 
--실습4-48
SELECT M.NAME FROM MEMBER M JOIN LOAN L ON M.MEMBER_ID=L.MEMBER_ID JOIN BOOK B ON L.BOOK_ID=B.BOOK_ID GROUP BY M.NAME ORDER BY COUNT(*) DESC FETCH FIRST 1 ROW ONLY; 
--실습4-49
SELECT TITLE FROM BOOK WHERE PUBLISHER IN(SELECT PUBLISHER FROM BOOK WHERE TITLE='데이터베이스') AND TITLE!='데이터베이스';
--실습4-50
SELECT NAME FROM MEMBER WHERE MEMBER_ID IN(SELECT MEMBER_ID FROM LOAN WHERE BOOK_ID=10004);
